"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[2450],{5346:(m,p,s)=>{s.d(p,{ez:()=>d,tP:()=>r});var r=(()=>((r=r||{}).Documents="DOCUMENTS",r.Data="DATA",r.Library="LIBRARY",r.Cache="CACHE",r.External="EXTERNAL",r.ExternalStorage="EXTERNAL_STORAGE",r))(),d=(()=>((d=d||{}).UTF8="utf8",d.ASCII="ascii",d.UTF16="utf16",d))()},2450:(m,p,s)=>{s.r(p),s.d(p,{ChatsPageModule:()=>F});var r=s(6814),d=s(95),a=s(2125),g=s(228),h=s(5861),t=s(6689),u=s(2726),f=s(5346);const C=(0,u.fo)("Filesystem",{web:()=>s.e(4522).then(s.bind(s,4522)).then(n=>new n.FilesystemWeb)});var x=s(4004),v=s(553),_=s(9209),P=s(3393),M=s(8318),y=s(8881);const b=["content"];function O(n,o){1&n&&(t.TgZ(0,"div",25),t._UZ(1,"div")(2,"div")(3,"div")(4,"div")(5,"div")(6,"div")(7,"div")(8,"div")(9,"div")(10,"div")(11,"div")(12,"div"),t.qZA())}function T(n,o){if(1&n&&(t.TgZ(0,"ion-text",33),t._uU(1),t.qZA()),2&n){const e=t.oxw().$implicit;t.xp6(1),t.hij(" ",e.message," ")}}function Z(n,o){if(1&n){const e=t.EpF();t.TgZ(0,"img",34),t.NdJ("click",function(){t.CHM(e);const c=t.oxw().$implicit,l=t.oxw();return t.KtG(l.adjustImage(c.message))}),t.qZA()}if(2&n){const e=t.oxw().$implicit,i=t.oxw();t.Q6J("src",i.environments.url+"/media/"+e.message+".png",t.LSH)}}function w(n,o){if(1&n&&(t.TgZ(0,"audio",35),t._UZ(1,"source",36,37),t.qZA()),2&n){const e=t.oxw().$implicit,i=t.oxw();t.xp6(1),t.Q6J("src",i.environments.url+"/media/"+e.message+".ogg",t.LSH)}}function S(n,o){if(1&n&&(t.TgZ(0,"ion-text",38),t._uU(1),t.qZA()),2&n){const e=t.oxw().$implicit;t.xp6(1),t.hij(" ",e.caption," ")}}function A(n,o){1&n&&t._UZ(0,"ion-icon",39)}const k=function(n,o,e){return{"message--sent ms-auto":n,"message--get":o,"ion-no-padding":e}};function I(n,o){if(1&n&&(t.TgZ(0,"ion-item",26)(1,"div",27),t.YNc(2,T,2,1,"ion-text",28),t.YNc(3,Z,1,1,"img",29),t.YNc(4,w,3,1,"audio",30),t.YNc(5,S,2,1,"ion-text",31),t.qZA(),t.YNc(6,A,1,0,"ion-icon",32),t.qZA()),2&n){const e=o.$implicit;t.Q6J("ngClass",t.kEZ(6,k,e.owner,!e.owner,"photo"===e.type||"voice"===e.type)),t.xp6(2),t.Q6J("ngIf","text"===e.type),t.xp6(1),t.Q6J("ngIf","photo"===e.type),t.xp6(1),t.Q6J("ngIf","voice"===e.type),t.xp6(1),t.Q6J("ngIf",e.caption),t.xp6(1),t.Q6J("ngIf","pending"===(null==e?null:e.status))}}function J(n,o){if(1&n&&(t.TgZ(0,"ion-content"),t._UZ(1,"img",40),t.qZA()),2&n){const e=t.oxw();t.xp6(1),t.Q6J("src",e.environments.url+"/media/"+e.idAdjustImage+".png",t.LSH)}}const U=[{path:"",component:(()=>{class n{constructor(e,i,c,l,N){this.router=e,this.apiService=i,this.dataShare=c,this.simpleService=l,this.webSocketService=N,this.activatedRoute=(0,t.f3M)(g.gz),this.botCondition=!1,this.isOpenAdjustImage=!1,this.idAdjustImage="",this.environments=v.N,this.messagesList=[],this.message=""}ngOnInit(){this.simpleService.changes.subscribe(()=>{setTimeout(()=>{this.content.scrollToBottom(1)},100)})}ionViewWillEnter(){this.currentUser=this.dataShare.selectedUser,this.currentUser.client_id||(this.currentUser=JSON.parse(sessionStorage.getItem("currentUser")||"")),this.folder=this.activatedRoute.snapshot.paramMap.get("id"),this.dataShare.selectedUserId=this.currentUser.client_id,this.folder||this.closeChat(),this.apiService.getBotCondtion(this.folder).subscribe(e=>{this.botCondition=e.switch.is_support}),this.apiService.getMessages(this.folder).subscribe(e=>{this.runWebsocket(),this.simpleService.messages=e,setTimeout(()=>{this.content.scrollToBottom(1)},100)},e=>{this.closeChat()})}ionViewDidEnter(){this.content.scrollToBottom(1),this.apiService.readMessage(this.folder).subscribe(()=>{})}runWebsocket(){this.simpleService.selectChat(this.folder)}closeChat(){this.router.navigate(["/control"])}changeBotCondition(e){console.log(e.detail.checked),this.apiService.changeBotCondtion({id:this.folder,is_support:!e.detail.checked}).subscribe(()=>{})}sendMessage(){if(!this.message.length)return;const e=x.Z();this.simpleService.pendingList.push(e),this.simpleService.messages.push({message:this.message,MessageId:e,status:"pending",type:"text",owner:!0}),this.apiService.sendMessage({Sender:this.currentUser.client_id,Message:this.message,MessageType:"text",ClientName:"telegram",Caption:"",MessageId:e}).subscribe(i=>{this.apiService.getBotCondtion(this.folder).subscribe(c=>{this.botCondition=c.switch.is_support})},i=>{}),this.message=""}saveAudio(e){return(0,h.Z)(function*(){return(yield C.writeFile({path:`${e.client_id}-${e.message_id}.wav`,data:e.base64,directory:f.tP.Data})).uri})()}adjustImage(e){this.idAdjustImage=e,this.isOpenAdjustImage=!0}closeAdjustImage(){this.idAdjustImage="",this.isOpenAdjustImage=!1}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(g.F0),t.Y36(_.s),t.Y36(P.k),t.Y36(M.S),t.Y36(y.i))},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-chats"]],viewQuery:function(e,i){if(1&e&&t.Gf(b,5),2&e){let c;t.iGM(c=t.CRH())&&(i.content=c.first)}},decls:30,vars:8,consts:[[1,"header",3,"translucent"],["slot","start",1,"ps-1"],[1,"back-arrow","me-1","p-1","fs-1",3,"click"],["name","arrow-back-outline"],[1,"header-details","d-flex","align-items-center","ion-justify-content-between","pe-3"],[1,"avatar"],["alt","Silhouette of a person's head","src","https://ionicframework.com/docs/img/demos/avatar.svg",1,"ion-margin-end"],[1,"text-start","title"],[1,"d-flex","flex-column","h-100"],[1,"d-block","h-auto","ion-no-margin","ion-no-padding","name","justify-content-center"],["enableOnOffLabels","true","slot","end",1,"fs-3",3,"checked","ionChange"],["name","logo-android"],[1,"chat","body",3,"fullscreen"],["content",""],[1,"chat__box"],["class","lds-spinner",4,"ngIf"],["lines","none",1,"chat__list","w-100","d-flex","flex-column","ion-justify-content-end"],["class","message m-2",3,"ngClass",4,"ngFor","ngForOf"],[3,"isOpen","didDismiss"],[1,"ion-no-border","footer","ion-no-padding"],[1,"ion-no-padding"],[1,"footer","d-flex","align-items-center","ps-3","py-3"],["autosize","","placeholder","Enter message",1,"textarea","outline-0","w-100","p-2",3,"ngModel","ngModelChange"],[1,"send","px-2","fs-1",3,"click"],["name","arrow-forward-circle"],[1,"lds-spinner"],[1,"message","m-2",3,"ngClass"],[1,"item-inner","d-flex","flex-column"],["class","py-1",4,"ngIf"],["alt","",3,"src","click",4,"ngIf"],["controls","controls","preload","auto",4,"ngIf"],["class","px-3 py-2 d-block",4,"ngIf"],["class","pending","name","time",4,"ngIf"],[1,"py-1"],["alt","",3,"src","click"],["controls","controls","preload","auto"],["type","audio/ogg",3,"src"],["audio",""],[1,"px-3","py-2","d-block"],["name","time",1,"pending"],["alt","",3,"src"]],template:function(e,i){1&e&&(t.TgZ(0,"ion-header",0)(1,"ion-toolbar")(2,"ion-buttons",1)(3,"button",2),t.NdJ("click",function(){return i.closeChat()}),t._UZ(4,"ion-icon",3),t.qZA()(),t.TgZ(5,"div",4)(6,"ion-avatar",5),t._UZ(7,"img",6),t.qZA(),t.TgZ(8,"ion-title",7)(9,"div",8)(10,"p",9),t._uU(11),t.qZA()()(),t.TgZ(12,"ion-toggle",10),t.NdJ("ionChange",function(l){return i.changeBotCondition(l)}),t._uU(13," ."),t._UZ(14,"ion-icon",11),t._uU(15,". "),t.qZA()()()(),t.TgZ(16,"ion-content",12,13)(18,"div",14),t.YNc(19,O,13,0,"div",15),t.TgZ(20,"ion-list",16),t.YNc(21,I,7,10,"ion-item",17),t.qZA()(),t.TgZ(22,"ion-modal",18),t.NdJ("didDismiss",function(){return i.closeAdjustImage()}),t.YNc(23,J,2,1,"ng-template"),t.qZA()(),t.TgZ(24,"ion-footer",19)(25,"ion-toolbar",20)(26,"div",21)(27,"textarea",22),t.NdJ("ngModelChange",function(l){return i.message=l}),t.qZA(),t.TgZ(28,"button",23),t.NdJ("click",function(){return i.sendMessage()}),t._UZ(29,"ion-icon",24),t.qZA()()()()),2&e&&(t.Q6J("translucent",!0),t.xp6(11),t.hij(" ",i.folder," "),t.xp6(1),t.Q6J("checked",!i.botCondition),t.xp6(4),t.Q6J("fullscreen",!0),t.xp6(3),t.Q6J("ngIf",!(null!=i.simpleService.messages&&i.simpleService.messages.length)),t.xp6(2),t.Q6J("ngForOf",i.simpleService.messages),t.xp6(1),t.Q6J("isOpen",i.isOpenAdjustImage),t.xp6(5),t.Q6J("ngModel",i.message))},dependencies:[r.mk,r.sg,r.O5,d.Fj,d.JJ,d.On,a.BJ,a.Sm,a.W2,a.fr,a.Gu,a.gu,a.Ie,a.q_,a.yW,a.wd,a.ho,a.sr,a.ki,a.w],styles:['.avatar[_ngcontent-%COMP%]{width:40px;height:40px}.chat__list[_ngcontent-%COMP%]{background:transparent}.message[_ngcontent-%COMP%]{width:-moz-fit-content;width:fit-content;max-width:75%;font-family:SF Pro Text;font-family:Segoe UI,Tahoma,Geneva,Verdana,sans-serif}.message--get[_ngcontent-%COMP%]{border-radius:16px 16px 16px 0;--border-radius: 16px 16px 16px 0px;--background: var(--white);border:1px solid var(--grey-whisper)}.message--sent[_ngcontent-%COMP%]{border-radius:16px 16px 0;--border-radius: 16px 16px 0px 16px;--background: var(--grey-whisper);color:var(--black)}.ion-no-padding[_ngcontent-%COMP%]{--padding-end: 0px;--inner-padding-end: 0px}.chat-textarea[_ngcontent-%COMP%]{height:vh!important}.send[_ngcontent-%COMP%]{background-color:transparent;cursor:pointer}.back-arrow[_ngcontent-%COMP%]{font-size:25px;background:transparent}.textarea[_ngcontent-%COMP%]{line-height:16px;resize:none;height:50px;border-radius:20px;border:1px solid var(--grey-whisper);background:var(--white);outline:none!important;color:var(--black, #000);font-size:14px;font-family:SF Pro Text;font-weight:500}.textarea[_ngcontent-%COMP%]::placeholder{color:var(--light-grey, #7a7a7a);font-size:14px;font-family:SF Pro Text;font-weight:500;line-height:30px}.textarea[_ngcontent-%COMP%]:focus-visible{border:1px solid var(--grey-whisper)!important}.textarea[_ngcontent-%COMP%]:focus{border:1px solid var(--grey-whisper)!important}.lds-spinner[_ngcontent-%COMP%]{color:#000;display:inline-block;position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);width:40px;height:20px;-webkit-transform:translate(-50%,-50%);-moz-transform:translate(-50%,-50%);-ms-transform:translate(-50%,-50%);-o-transform:translate(-50%,-50%)}.lds-spinner[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{transform-origin:13px 9px;animation:_ngcontent-%COMP%_lds-spinner 1.2s linear infinite}.lds-spinner[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]:after{content:" ";display:block;position:absolute;top:0px;left:11px;width:2px;height:6px;border-radius:20%;background:var(--black)}.lds-spinner[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]:nth-child(1){transform:rotate(0);animation-delay:-1.1s}.lds-spinner[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]:nth-child(2){transform:rotate(30deg);animation-delay:-1s}.lds-spinner[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]:nth-child(3){transform:rotate(60deg);animation-delay:-.9s}.lds-spinner[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]:nth-child(4){transform:rotate(90deg);animation-delay:-.8s}.lds-spinner[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]:nth-child(5){transform:rotate(120deg);animation-delay:-.7s}.lds-spinner[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]:nth-child(6){transform:rotate(150deg);animation-delay:-.6s}.lds-spinner[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]:nth-child(7){transform:rotate(180deg);animation-delay:-.5s}.lds-spinner[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]:nth-child(8){transform:rotate(210deg);animation-delay:-.4s}.lds-spinner[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]:nth-child(9){transform:rotate(240deg);animation-delay:-.3s}.lds-spinner[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]:nth-child(10){transform:rotate(270deg);animation-delay:-.2s}.lds-spinner[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]:nth-child(11){transform:rotate(300deg);animation-delay:-.1s}.lds-spinner[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]:nth-child(12){transform:rotate(330deg);animation-delay:0s}@keyframes _ngcontent-%COMP%_lds-spinner{0%{opacity:1}to{opacity:0}}.text-area[_ngcontent-%COMP%]::part(placeholder){color:red}ion-modal[_ngcontent-%COMP%]{--height: 50%;--weight: 90%;--background: transparent;background:transparent;--box-shadow: 0 10px 15px -3px rgb(0 0 0 / .1), 0 4px 6px -4px rgb(0 0 0 / .1);--backdrop-opacity: 100%}ion-modal[_ngcontent-%COMP%]   ion-content[_ngcontent-%COMP%]{--background: transparent}#background-content[_ngcontent-%COMP%]{background:transparent!important}.pending[_ngcontent-%COMP%]{font-size:12px;margin-left:5px}']}),n})()}];let j=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=t.oAB({type:n}),n.\u0275inj=t.cJS({imports:[g.Bz.forChild(U),g.Bz]}),n})(),F=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=t.oAB({type:n}),n.\u0275inj=t.cJS({imports:[r.ez,d.u5,a.Pc,j]}),n})()}}]);